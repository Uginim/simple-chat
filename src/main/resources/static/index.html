<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--    stomp -->
    <title>RandomChat</title>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.0.0/bundles/stomp.umd.min.js"></script>
</head>
<body>
<script>
    const stompClient = new StompJs.Client({
        brokerURL: 'ws://localhost:8080/ws',
    });

    function connect() {
        console.log('Connecting to WS...');
        stompClient.activate();
    }

    stompClient.onConnect = function (frame) {
        // setConnected(true);
        stompClient.subscribe('/chat/messages', function (message) {
            console.log(message);
            showMessage(JSON.parse(message.body).content);
        });
    };

    stompClient.onWebSocketError = (error) => {
        console.log('Websocket Error', error);
    };

    stompClient.onStompError = (frame) => {
        console.log('Broker reported error: ' + frame.headers['message']);
        console.log('Additional details: ' + frame.body);
    };

    const showMessage = (message) => {
        const messageElement = document.createElement('div');
        messageElement.appendChild(document.createTextNode(message));
        document.getElementById('messages').appendChild(messageElement);
    };

    function sendMessage() {
        const content = document.getElementById('message').value;
        console.log(content);
        stompClient.publish({
            destination: '/app/send', body: JSON.stringify({
                content: content,
                sender: 'guest',
                messageType: 'CHAT'
            })
        });
    }
</script>
<button id="connect" onclick="connect()">Connect</button>
<input id="message" type="text">
<button id="send" onclick="sendMessage()">Send</button>
<div id="messages"></div>
</body>
</html>